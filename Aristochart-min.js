/**
 * Aristochart.js
 *
 * http://dunxrion.github.com/aristochart
 * 
 * @version 0.2
 * @author Adrian Cooney <cooney.adrian@gmail.com> (http://adriancooney.ie)
 * @license http://opensource.org/licenses/MIT
 */
(()=>{var a=function(A,b,c){!A||!A.DOCUMENT_NODE&&(b=A,A=document.createElement('canvas'));if(!b||!b.data)throw Error('Please provide some data to plot.');if(!b.data.y||!b.data.x)throw Error('Please provide some data.x and data.y');b.width&&!b.height&&(b.height=~~b.width*0.67);this.defaults=a.themes.default;this.options=b;this.canvas=A;this.theme=c;this.data=this.options.data;this.theme&&(this.defaults=a._deepMerge(this.defaults,this.theme));for(var d in this.defaults)this.options=a._deepMerge(this.defaults,this.options);for(var e in this.options.style)for(var d in this.options.style['default'])this.options.style[e]=a._deepMerge(this.options.style['default'],this.options.style[e]);this.indexes=[];that=this;for(const _ of ['fill','axis','tick','line','point','label','title'])if(that.indexes[that.options[_].index])throw Error('Conflicting indexes in Aristochart');else that.indexes[that.options[_].index]=_;this.indexes=this.indexes.filter(function(B){if(B)return!0});if(this.canvas.getContext)this.ctx=this.canvas.getContext('2d');else{var f=document.createElement('canvas');this.canvas.appendChild(f);this.canvas=f;this.ctx=f.getContext('2d')}this.canvas.height=this.options.height;this.canvas.width=this.options.width;window.devicePixelRatio>1&&(this.canvas.style.height=this.canvas.height+'px',this.canvas.style.width=this.canvas.width+'px',this.canvas.height=this.canvas.height*window.devicePixelRatio,this.canvas.width=this.canvas.width*window.devicePixelRatio);this.resolution=window.devicePixelRatio||1;this.update();this.options.render&&this.render()};a._deepMerge=(C,_b)=>function _c(_a,D){for(var _d in _a)D[_d]==void 0?D[_d]=_a[_d]:_a[_d] instanceof Object&&(D[_d]=_c(_a[_d],D[_d]));return D}(C,_b);a.prototype.refreshBounds=function(){var _A=-Infinity,_B=Infinity;for(var _C in this.data)if(_C!=='x'){var _D=-Infinity,E=Infinity;for(const v of this.data[_C]){v>_D&&(_D=v);v<E&&(E=v)}_D>_A&&(_A=_D);E<_B&&(_B=E)}this.y={max:this.options.axis.y.max==void 0?_A:this.options.axis.y.max,min:this.options.axis.y.min==void 0?_B:this.options.axis.y.min};this.y.range=this.y.max-this.y.min;this.data.x.length==1||typeof this.data.x=='number'?this.x={min:0,max:this.data.x[0]||this.data.x}:this.x={min:this.data.x[0],max:this.data.x[this.data.x.length-1]};this.x.range=this.x.max-this.x.min};a.prototype.update=function(){var aA=this.resolution,aB=this.getPoints();this.options.margin*=aA;this.options.padding*=aA;this.options.width*=aA;this.options.height*=aA;this.box={x:this.options.margin,y:this.options.margin,x1:this.options.width-2*this.options.margin,y1:this.options.height-2*this.options.margin};this.refreshBounds();this.lines=aB.lines;this.origin=aB.origin;var aC=this.options.padding,aD=this.box;this.axis={x:{x:aD.x-aC,y:aD.y+aD.y1+aC,x1:that.box.x+aD.x1+aC,y1:aD.y+aD.y1+aC},y:{x:aD.x-aC,y:aD.y-aC,x1:aD.x-aC,y1:aD.y+aD.y1+aC}}};a.prototype.render=function(){var aE=this,aF=this.lines,aG=this.origin,aH=this.axis,_e=aE.options.style.default;var F=~~this.options.axis.x.steps,g=~~this.options.axis.y.steps;var h=aG.x,I=aG.y;for(const aI of this.indexes)switch(aI) {case 'point':for(var j in aF)if((aE.options.style[j]||_e).point.visible)for(const aJ of aF[j])aE.options.point.render.call(aE,aE.options.style[j]||_e,aJ.rx,aJ.ry,aJ.x,aJ.y,aJ.graph);break;case 'axis':_e.axis.visible&&(_e.axis.x.visible&&aE.options.axis.x.render.call(aE,_e,aH.x.x,_e.axis.y.fixed?aH.x.y:I,aH.x.x1,_e.axis.y.fixed?aH.x.y1:I,'x'),_e.axis.y.visible&&aE.options.axis.y.render.call(aE,_e,_e.axis.x.fixed?aH.y.x:h,aH.y.y,_e.axis.x.fixed?aH.y.x1:h,aH.y.y1,'y'));break;case 'line':for(var j in aF){var k=aE.options.style[j]||_e;k.line.visible&&aE.options.line.render.call(aE,k,aF[j])}break;case 'tick':if(_e.tick.visible){var l=aE.box.x1/F,m=aE.box.y1/g;for(var i=0;i<F+1;i++)aE.options.tick.render.call(aE,_e,aE.box.x+l*i,_e.tick.x.fixed?aH.x.y1:I,'x',i);for(var i=0;i<g+1;i++)aE.options.tick.render.call(aE,_e,_e.tick.y.fixed?aH.y.x1:h,aE.box.y+m*i,'y',i)}break;case 'label':var l=aE.box.x1/F,m=aE.box.y1/g;if(_e.label.x.visible)for(var i=0;i<F+1;i++)aE.options.label.render.call(aE,_e,aE.x.min+(aE.x.max-aE.x.min)/F*i,aE.box.x+l*i,_e.label.x.fixed?aH.x.y1:I,'x',i);if(_e.label.y.visible)for(var i=0;i<g+1;i++){var o=g-i,p=aE.y.min+(aE.y.max-aE.y.min)/g*o;aE.options.label.render.call(aE,_e,p,_e.label.y.fixed?aH.y.x1:h,aE.box.y+m*i,'y',i)}break;case 'fill':for(var j in aF){var k=aE.options.style[j]||_e;k.line.fill&&aE.options.fill.render.call(aE,k,aF[j])}break;case 'title':if(_e.title.visible){var q=aE.options.title.x,r=aE.options.title.y;_e.title.x.visible&&aE.options.title.render.call(aE,_e,q,(aE.box.x*2+aE.box.x1)/2,aE.box.y+aE.box.y1,'x');_e.title.y.visible&&aE.options.title.render.call(aE,_e,r,aE.box.x,(aE.box.y*2+aE.box.y1)/2,'y')}break}};a.prototype.getPoints=function(aK){var aL={},aM=this.x.range,aN=this.y.max,_E=this.y.range,_f=this.box.x,G=this.box.y,H=this.box.x1,_i=this.box.y1,J=G+_i/_E*aN;for(var K in this.data){if(K=='x')continue;aL[K]=[];var L=this.data[K],M=L.length,n=1;M>1e3&&(n=5);M>1e4&&(n=50);M>1e5&&(n=5e3);var O=M/n;for(var i=0;i<O;i++){var Q=aM/(O-1)*i,y=L[i],s=_f+H/aM*Q,t=J-_i/_E*y;aL[K].push({x:Q,y,rx:s,ry:t});aK&&aK(s,t,x,y,K)}}return{lines:aL,origin:{x:_f,y:J}}};a.prototype.toImage=function(){var aO=new Image();aO.src=this.canvas.toDataURL('image/png');return aO};a.point={circle:function(aP,aQ,aR){this.ctx.save();this.ctx.strokeStyle=aP.point.stroke;this.ctx.lineWidth=aP.point.width*this.resolution;this.ctx.fillStyle=aP.point.fill;this.ctx.beginPath();this.ctx.arc(aQ,aR,aP.point.radius*this.resolution,0,Math.PI*2,!0);this.ctx.fill();this.ctx.stroke();this.ctx.restore()}};a.line={line:function(aS,aT){this.ctx.save();this.ctx.strokeStyle=aS.line.stroke;this.ctx.lineWidth=aS.line.width*this.resolution;this.ctx.beginPath();this.ctx.moveTo(aT[0].rx,aT[0].ry);var aU=this;for(const aV of aT)aU.ctx.lineTo(aV.rx,aV.ry);this.ctx.stroke();this.ctx.restore()},fill:function(aW,aX){this.ctx.save();this.ctx.fillStyle=aW.line.fill;this.ctx.beginPath();this.ctx.moveTo(aX[0].rx,aX[0].ry);var aY=this;for(const aZ of aX)aY.ctx.lineTo(aZ.rx,aZ.ry);this.ctx.lineTo(aX[aX.length-1].rx,this.box.y+this.box.y1+(aW.line.fillToBaseLine?this.options.padding:0));this.ctx.lineTo(aX[0].rx,this.box.y+this.box.y1+(aW.line.fillToBaseLine?this.options.padding:0));this.ctx.closePath();this.ctx.fill();this.ctx.restore()}};a.tick={line:function(bA,bB,y,bC,i){this.ctx.save();this.ctx.strokeStyle=bA.tick.stroke;this.ctx.lineWidth=bA.tick.width*this.resolution;this.ctx.beginPath();var _F=!(i%2)?bA.tick.major:bA.tick.minor;_F*=this.resolution;var _g=bB,_h=y;switch(bA.tick.align) {case 'middle':bC=='x'&&(_h=y-_F/2);bC=='y'&&(_g=bB-_F/2);break;case 'inside':bC=='x'&&(_h=y-_F);_g=bB;break;case 'outside':bC=='x'&&(_h=y);bC=='y'&&(_g=bB-_F);break}this.ctx.moveTo(_g,_h);bC=='x'?this.ctx.lineTo(_g,_h+_F):this.ctx.lineTo(_g+_F,_h);this.ctx.stroke();this.ctx.restore()}};a.axis={line:function(bD,bE,y,bF,bG){this.ctx.save();this.ctx.strokeStyle=bD.axis.stroke;this.ctx.lineWidth=bD.axis.width*this.resolution;this.ctx.beginPath();this.ctx.moveTo(bE,y);this.ctx.lineTo(bF,bG);this.ctx.stroke();this.ctx.restore()}};a.label={text:function(bH,bI,bJ,y,bK,i){if(!(i%this.options.label[bK].step)){var _G=bH.label[bK],_H=/(\-?\d+(\.\d)?)/.exec(bI)||[];bK=='x'&&(y=y+(bH.tick.major+_G.offsetY)*this.resolution);bK=='y'&&(bJ=bJ-(bH.tick.major+_G.offsetX)*this.resolution,y+=_G.offsetY*this.resolution);this.ctx.font=_G.fontStyle+' '+_G.fontSize*this.resolution+'px '+_G.font;this.ctx.fillStyle=_G.color;this.ctx.textAlign=_G.align;this.ctx.textBaseline=_G.baseline;this.ctx.fillText(_H[0],bJ,y)}}};a.title={text:function(bL,bM,bN,y,bO){this.ctx.save();bO=='x'&&(y+=bL.title.x.offsetY,bN+=bL.title.x.offsetX);bO=='y'&&(y+=bL.title.y.offsetY,bN+=bL.title.y.offsetX);this.ctx.font=bL.title.fontStyle+' '+bL.title.fontSize*this.resolution+'px '+bL.title.font;this.ctx.fillStyle=bL.title.color;this.ctx.translate(bN,y);bO=='y'&&this.ctx.rotate(Math.PI/2);this.ctx.fillText(bM,0,0);this.ctx.restore()}};window.jQuery&&(jQuery.fn.aristochart=function(bP,bQ){if(this.length>1)this.each(function(){new a(this[0], bP, bQ)});else return new a(this[0], bP, bQ)});a.themes={};a.themes.default={width:640,height:400,margin:70,padding:20,render:!0,fill:{index:0,render:a.line.fill},axis:{index:1,render:a.axis.line,x:{steps:5,render:a.axis.line},y:{steps:10,render:a.axis.line}},tick:{index:2,render:a.tick.line},line:{index:3,render:a.line.line},point:{index:4,render:a.point.circle},label:{index:5,render:a.label.text,x:{step:1},y:{step:1}},title:{index:6,render:a.title.text,x:'x',y:'y'},style:{default:{point:{stroke:'#000',fill:'#fff',radius:4,width:3,visible:!0},line:{stroke:'#298281',width:3,fill:'rgba(150, 215, 226, 0.4)',fillToBaseLine:!0,visible:!0},axis:{stroke:'#ddd',width:3,visible:!0,x:{visible:!0,fixed:!0},y:{visible:!0,fixed:!0}},tick:{align:'middle',stroke:'#ddd',width:2,minor:10,major:15,visible:!0,x:{fixed:!0},y:{fixed:!0}},label:{x:{font:'Helvetica',fontSize:14,fontStyle:'normal',color:'#000',align:'center',baseline:'bottom',offsetY:8,offsetX:3,visible:!0,fixed:!0},y:{font:'Helvetica',fontSize:10,fontStyle:'normal',color:'#000',align:'center',baseline:'bottom',offsetY:8,offsetX:8,visible:!0,fixed:!0}},title:{color:'#777',font:'georgia',fontSize:'16',fontStyle:'italic',visible:!0,x:{offsetX:0,offsetY:120,visible:!0},y:{offsetX:-135,offsetY:10,visible:!0}}}}};window.Aristochart=a})();
